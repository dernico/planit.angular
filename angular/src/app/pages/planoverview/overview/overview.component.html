
<h1>{{plan.title}}</h1>
<span style="position: absolute; right: 10px; top: 10px;" (click)="backToPlannings()">Back to all plannings (click)</span>

<span *ngFor="let user of plan.users" >
    <img [src]="user.picture" height="50" [title]="user.email" />
    <!-- <span (click)="">X</span> -->
</span>

<br />
<button (click)="sharePlan()">Share</button>

<hr>

<label>Start</label>
<mat-form-field>
    <input matInput [matDatepicker]="startDatePicker" [ngModel]="plan.startDate | date:'yyyy-MM-dd'" (ngModelChange)="plan.startDate=$event;planChanged();"
        placeholder="When do you wanna start">
</mat-form-field>
<mat-datepicker-toggle [for]="startDatePicker"></mat-datepicker-toggle>
<mat-datepicker #startDatePicker></mat-datepicker>


<label>End</label>
<mat-form-field>
    <input matInput [matDatepicker]="endDatePicker" [ngModel]="plan.endDate | date:'yyyy-MM-dd'" (ngModelChange)="plan.endDate=$event;planChanged();"
        placeholder="When do you have to go">
</mat-form-field>
<mat-datepicker-toggle [for]="endDatePicker"></mat-datepicker-toggle>
<mat-datepicker #endDatePicker></mat-datepicker>

<app-file-upload 
[(plan)]="plan._id"
(saveCallback)="addFilesToPlan($event, plan._id)"
maxFiles="4"
maxSize="2"
fileExt="JPG, GIF, PNG, PDF"
infoText="Drop your flight tickets, car voucher etc. here" >
</app-file-upload>

<h2>Stops</h2>

<places-input
    placeholderInput="Where?"
    (selectionChanged)="placesSelectionChanged($event)"
></places-input>

<mat-form-field>
    <input matInput [(ngModel)]="stepDays" type="number" placeholder="How many days you wanna stop?">
</mat-form-field>
<button (click)="addStep(selectedSuggestion, stepDays)">Add</button>


<div>
    <ul *ngIf="plan.files">
        <li *ngFor="let file of plan.files; let i = index">
            <span (click)="downloadFile(file)">{{i + 1}}. {{file.filename}}</span>
            <button (click)="deleteFileFromPlan(i)">delete</button>
        </li>
    </ul>
</div>

<div *ngIf="plan.steps">
    <div *ngFor="let step of plan.steps; let i = index;">
        <h3 (click)="step.edit = true;" *ngIf="!step.edit">
            {{i + 1}}. {{step.title}} ({{step.days}} days)
        </h3>
        <div *ngIf="step.edit">
            <places-input
                placeholderInput="Where?"
                (selectionChanged)="placesSelectionUpdate($event, i)"
            ></places-input>
            <input [(ngModel)]="step.days" type="number" (ngModelChange)="planChanged();" />
            <button (click)="step.edit = false;">Done</button>
            <button (click)="removeStep(i);">Remove</button>
        </div>
        <mat-card>
            <mat-card-header>
                <mat-card-title></mat-card-title>
            </mat-card-header>

            <mat-card-content>
                <div >
                    <agm-map [latitude]="step.location.lat" [longitude]="step.location.lng" [zoom]="12">
                        <agm-marker [latitude]="step.location.lat" [longitude]="step.location.lng"></agm-marker>
                        <agm-marker *ngFor="let todo of step.todos" [latitude]="todo.location.lat" [longitude]="todo.location.lng"></agm-marker>
                    </agm-map>
                </div>
            </mat-card-content>
            <mat-card-footer>
                <span (click)="goToDetails(step._id)">Here you will find your details</span>
            </mat-card-footer>
        </mat-card>
    </div>
</div>